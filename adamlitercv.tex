% !TEX encoding = UTF-8 Unicode
% !TEX TS-program = arara
% arara: xelatex
% arara: biber
% arara: xelatex: { synctex: yes }

\documentclass{article}

% ------------------------------------------------------------------------------------------------
% FONTS
% ------------------------------------------------------------------------------------------------
\usepackage{fontspec}
\setmainfont{CMU Serif Roman}
\newfontfamily\NameFont{Italianno}
\usepackage{fontawesome}

% ------------------------------------------------------------------------------------------------
% DOCUMENT STUFF
% ------------------------------------------------------------------------------------------------
\setlength{\parindent}{0em}
\usepackage[margin=1in]{geometry}
\usepackage{multicol}
\usepackage{enumitem}
\usepackage{xcolor}
\usepackage{hyperref}
\newcommand*{\Colorhref}[2]{\href{#1}{\color{cyan}#2}}

% ------------------------------------------------------------------------------------------------
% HEADER AND FOOTER
% ------------------------------------------------------------------------------------------------
\usepackage{lastpage}
\usepackage{fancyhdr}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\lhead{}
\chead{}
\rhead{}
\lfoot{Last updated: \today}
\cfoot{}
\rfoot{\thepage/\pageref{LastPage}}
\pagestyle{fancy}

% ------------------------------------------------------------------------------------------------
% FOR BIBLIOGRAPHIC STUFF
% ------------------------------------------------------------------------------------------------
\usepackage[american]{babel}
\usepackage{csquotes}
\usepackage[
	bibstyle=biblatex-sp-unified,% see https://github.com/semprag/biblatex-sp-unified
	sorting=ydmdDdt
]{biblatex}
\addbibresource{content/AdamLiterReferences.bib}
	% ------------------------------------------------------------------------------------------------
	% New sorting scheme for CV
	% ------------------------------------------------------------------------------------------------
	% Based on ynt sorting scheme of biblatex
	% Except:
	% 	(i) don't sort on n(ame)
	% 	(ii) ignore presort
	% 	(iii) and do the following:
	% sort by year, desecnding (yd);
	% then by month, desecnding (md);
	% then by day, descending (Dd);
	% then by title (t)
	%
	% See also http://tex.stackexchange.com/a/46879/32888
	%
	\DeclareSortingScheme{ydmdDdt}{
		%\sort{
		%	\field{presort}
		%}
		%\sort[final]{
		%	\field{sortkey}
		%}
		\sort[direction=descending]{
			\field{sortyear}
			\field{year}
			\literal{9999}
		}
		\sort[direction=descending]{
			\field[padside=left,padwidth=2,padchar=0]{month}
			\literal{00}
		}
		\sort[direction=descending]{
			\field[padside=left,padwidth=2,padchar=0]{day}
			\literal{00}
		}
		\sort{
			\field{sorttitle}
			\field{title}
		}
	}
	% ------------------------------------------------------------------------------------------------
	% Always bold my name in the citation; see http://tex.stackexchange.com/a/73246/32888
	% ------------------------------------------------------------------------------------------------
	\usepackage{xpatch}
	
	\newbibmacro*{name:bold}[2]{%
		\def\do##1{\ifstrequal{#1, #2}{##1}{\bfseries\listbreak}{}}%
		\dolistloop{\boldnames}}
	\newcommand*{\boldnames}{}
	
	\xpretobibmacro{name:last}{\begingroup\usebibmacro{name:bold}{#1}{#2}}{}{}
	\xpretobibmacro{name:first-last}{\begingroup\usebibmacro{name:bold}{#1}{#2}}{}{}
	\xpretobibmacro{name:last-first}{\begingroup\usebibmacro{name:bold}{#1}{#2}}{}{}
	\xpretobibmacro{name:delim}{\begingroup\normalfont}{}{}
	
	\xapptobibmacro{name:last}{\endgroup}{}{}
	\xapptobibmacro{name:first-last}{\endgroup}{}{}
	\xapptobibmacro{name:last-first}{\endgroup}{}{}
	\xapptobibmacro{name:delim}{\endgroup}{}{}
	
	\forcsvlist{\listadd\boldnames}
	{%
		{Liter, Adam},{Liter, A.},{Liter, Adam R.},{Liter, Adam Robert}%
	}
	% ------------------------------------------------------------------------------------------------
	% New driver for @misc
	% ------------------------------------------------------------------------------------------------
	\DeclareFieldFormat[misc]{title}{\mkbibquote{#1}}
	\DeclareFieldFormat[misc]{titlecase}{\MakeSentenceCase*{#1}}
	\DeclareBibliographyDriver{misc}{%
		\usebibmacro{bibindex}%
		\usebibmacro{begentry}%
		\usebibmacro{author/translator+others}%
		\setunit{\labelnamepunct}\newblock
		\usebibmacro{title}%
		\newunit
		\printlist{language}%
		\newunit\newblock
		\usebibmacro{byauthor}%
		\newunit\newblock
		\usebibmacro{byeditor+others}%
		\newunit\newblock
		\printfield{eventtitle}%              conference
		\setunit{\addspace}%
		\printfield[parens]{eventtitleaddon}% conference acronym, if it exists
		\setunit{\addcomma\addspace}%
		\printfield{venue}%                   university and/or location of conference
		\newunit\newblock
		\usebibmacro{finentry}}
% ------------------------------------------------------------------------------------------------
% CONTENT
% ------------------------------------------------------------------------------------------------
% needed pacakges
\usepackage{datatool}
\usepackage{etoolbox}
\usepackage{pgffor}
	% ------------------------------------------------------------------------------------------------
	% PERSYNAL INFO
	% ------------------------------------------------------------------------------------------------
	\DTLloaddb{personal}{content/personal.csv}
	% Get values for persynal info section of CV
	\DTLgetvalue{\Address}{personal}{1}{\dtlcolumnindex{personal}{Address}}
	\DTLgetvalue{\Phone}{personal}{1}{\dtlcolumnindex{personal}{Phone}}
	\DTLgetvalue{\Email}{personal}{1}{\dtlcolumnindex{personal}{Email}}
	\DTLgetvalue{\Website}{personal}{1}{\dtlcolumnindex{personal}{Website}}
	\DTLgetvalue{\WebsiteURL}{personal}{1}{\dtlcolumnindex{personal}{WebsiteURL}}
	% ------------------------------------------------------------------------------------------------
	% EDUCATION
	% ------------------------------------------------------------------------------------------------
	\DTLloaddb{education}{content/education.csv}
	% ------------------------------------------------------------------------------------------------
	% COURSES
	% ------------------------------------------------------------------------------------------------
	\DTLloaddb{courses}{content/courses.csv}	
	% ------------------------------------------------------------------------------------------------
	% AWARDS, HONORS, & FELLOWSHIPS
	% ------------------------------------------------------------------------------------------------
	\DTLloaddb{awards}{content/awards.csv}
	% Get each award type for subsection
	\newcommand*{\AwardTypes}{}
	\DTLforeach*{awards}{\Type=Type}{%
		\expandafter\DTLifinlist\expandafter{\Type}{\AwardTypes}%
		 {}% do nothing if already in list
		 {% else add to list
		 	\ifdefempty{\AwardTypes}%
			{\let\AwardTypes\Type}% first element of list
			{% else append to list
				\eappto\AwardTypes{,\Type}%
			}%
		}%
	}%
	% ------------------------------------------------------------------------------------------------
	% PUBLICATIONS
	% ------------------------------------------------------------------------------------------------
	%
	% ------------------------------------------------------------------------------------------------
	% PRESENTATIONS
	% ------------------------------------------------------------------------------------------------
	%
	% ------------------------------------------------------------------------------------------------
	% TEACHING
	% ------------------------------------------------------------------------------------------------
	\DTLloaddb{teaching}{content/teaching.csv}
	% Get each type of teaching
	\newcommand*{\TeachingTypes}{}
	\DTLforeach*{teaching}{\Type=Type}{%
		\expandafter\DTLifinlist\expandafter{\Type}{\TeachingTypes}%
		{}% do nothing if already in list
		{% else add to list
			\ifdefempty{\TeachingTypes}%
			{\let\TeachingTypes\Type}% first element of list
			{% else append to list
				\eappto\TeachingTypes{,\Type}
			}%
		}%
	}%
	% ------------------------------------------------------------------------------------------------
	% MENTORING
	% ------------------------------------------------------------------------------------------------	
	\DTLloaddb{mentoring}{content/mentoring.csv}
	% Get each academic year of undergraduate mentoring
	\newcommand*{\YearsOfMentoring}{}
	\DTLforeach*{mentoring}{\AcademicYear=AcademicYear}{%
		\expandafter\DTLifinlist\expandafter{\AcademicYear}{\YearsOfMentoring}%
		{}% do nothing if already in list
		{% else add to list
			\ifdefempty{\YearsOfMentoring}%
			{\let\YearsOfMentoring\AcademicYear}% first element of list
			{% else append to list
				\eappto\YearsOfMentoring{,\AcademicYear}%
			}%
		}%
	}%
	% ------------------------------------------------------------------------------------------------
	% PROFESSIONAL SERVICE
	% ------------------------------------------------------------------------------------------------
	\DTLloaddb{service}{content/service.csv}
	% ------------------------------------------------------------------------------------------------
	% PROFESSIONAL AFFILIATIONS
	% ------------------------------------------------------------------------------------------------		
	\DTLloaddb{affiliations}{content/affiliations.csv}
	% ------------------------------------------------------------------------------------------------
	% SKILLS
	% ------------------------------------------------------------------------------------------------	
	\DTLloaddb{skills}{content/skills.csv}
	% Get each type of skill
	\newcommand{\SkillTypes}{}
	\DTLforeach*{skills}{\Type=Type}{%
		\expandafter\DTLifinlist\expandafter{\Type}{\SkillTypes}%
		{}% do nothing if already in list
		{% else add to list
			\ifdefempty{\SkillTypes}%
				{\let\SkillTypes\Type}% first element in list
				{% else append to list
					\eappto\SkillTypes{,\Type}
				}
		}%
	}%

\begin{document}

% ------------------------------------------------------------------------------------------------
% PERSYNAL INFO
% ------------------------------------------------------------------------------------------------
\begin{center}
	{\Huge\NameFont Adam Liter}
\end{center}
%
\Address \hfill \faPhone\,\Phone \hfill \faEnvelope\,\href{mailto:\Email}{\Email} \hfill \faHome\,\href{\WebsiteURL}{\Website}\par
{\centering\hrulefill}

% ------------------------------------------------------------------------------------------------
% EDUCATION
% ------------------------------------------------------------------------------------------------
\section*{Education}

\DTLforeach*{education}{%
	\Degree=Degree,
	\Institution=Institution,
	\Location=Location,
	\Thesis=Thesis,
	\Committee=Committee,
	\GPA=GPA,
	\StartDate=StartDate,
	\EndDate=EndDate,
	\ExtraOne=Extra1,
	\ExtraTwo=Extra2%
}{%
	\begin{minipage}{\textwidth}
	\textbf{\Degree} \hfill \DTLifnullorempty{\StartDate}{\EndDate}{\StartDate\ -- \EndDate}\par
	\textit{\Institution}, \textit{\Location}\par
	%
	\DTLifnullorempty{\Thesis}{%
		% Do nothing if \Thesis is empty
	}{% If \Thesis is not empty
		\begin{description}[
		labelindent=15pt,
		topsep=0pt,
		partopsep=0pt,
		parsep=0pt,
		itemsep=0pt		
		]
			\item[Thesis:]{\Thesis}
			\item[Advised by:]{\Committee}
		\end{description}
		%
	}%
	\DTLifnullorempty{\ExtraOne}{%
		% Do nothing if \ExtraOne is empty
	}{% If \ExtraOne is not empty
		\begin{itemize}[
		topsep=0pt,
		partopsep=0pt,
		parsep=0pt,
		itemsep=0pt
		]
			\item{\ExtraOne}
			\DTLifnullorempty{\ExtraTwo}{}{\item{\ExtraTwo}}
		\end{itemize}
		%		
	}%
	\DTLifnullorempty{\GPA}{}{Cumulative GPA: \GPA}
	\DTLiflastrow{}{\vspace{1ex}}
	\end{minipage}
	%
}%

% ------------------------------------------------------------------------------------------------
% COURSES
% ------------------------------------------------------------------------------------------------
% This section is required for my TA application at Michigan State University
% For my normal CV, I will just comment this section out
% ------------------------------------------------------------------------------------------------
%\section*{Relevant Courses Taken}
%
%\begin{itemize}[
%topsep=0pt,
%partopsep=0pt,
%parsep=0pt,
%itemsep=0pt
%]
%
%\DTLforeach*{courses}{%
%	\Field=FieldOfCourse,
%	\CourseNumber=CourseNumber,
%	\CourseName=CourseName,
%	%\SemesterTaken=SemesterTaken,
%	\TakenAt=TakenAt%
%}{%
%	\item{\textsc{\Field} \CourseNumber\ -- \CourseName \hfill \textit{\TakenAt}}
%	%
%}
%
%\end{itemize}

% ------------------------------------------------------------------------------------------------
% AWARDS, HONORS, & FELLOWSHIPS
% ------------------------------------------------------------------------------------------------
\section*{Awards, Honors, \& Fellowships}

\foreach \x in \AwardTypes{%
	\subsection*{\x}
	\DTLforeach*[\DTLiseq{\Type}{\x}]{awards}{%
		\Type=Type,
		\Name=Name,
		\Granter=Granter,
		\AwardLocation=Location,
		\AwardStartDate=StartDate,
		\AwardEndDate=EndDate%
	}{%
		\begin{minipage}{\textwidth}
			\textbf{\Name} \hfill \DTLifnullorempty{\AwardStartDate}{\AwardEndDate}{\AwardStartDate\ -- \AwardEndDate}\par
			\textit{\Granter}, \textit{\AwardLocation}
			\DTLiflastrow{}{\vspace{1ex}}
		\end{minipage}
		%
	}%
}%	

% ------------------------------------------------------------------------------------------------
% PUBLICATIONS
% ------------------------------------------------------------------------------------------------
%\section*{Publications}

\nocite{*}

% ------------------------------------------------------------------------------------------------
% PRESENTATIONS
% ------------------------------------------------------------------------------------------------
\section*{Presentations}

\printbibliography[
	heading=subbibliography,
	title={Undergraduate conference -- talks},
	keyword=undergradconftalk
]

\printbibliography[
	heading=subbibliography,
	title={Undergraduate conference -- posters},
	keyword=undergradconfposter
]

% ------------------------------------------------------------------------------------------------
% TEACHING
% ------------------------------------------------------------------------------------------------
\section*{Teaching Experience}

\foreach \x in \TeachingTypes{%
	\subsection*{\x}
	\DTLforeach*[\DTLiseq{\Type}{\x}]{teaching}{%
		\Type=Type,
		\Class=Class,
		\University=University,
		\Date=Date%
	}{%
		\textbf{\Class} \hfill \Date\par
		\textit{\University}
		\DTLiflastrow{}{\vspace{1ex}}
		%
	}%
}%

% ------------------------------------------------------------------------------------------------
% MENTORING
% ------------------------------------------------------------------------------------------------
\section*{Undergraduate Mentoring}

\foreach \x in \YearsOfMentoring{%
	\subsection*{\x}
	%
	\begin{itemize}[
	topsep=0pt,
	partopsep=0pt,
	parsep=0pt,
	itemsep=0pt
	]
	%
	\DTLforeach*[\DTLiseq{\AcademicYear}{\x}]{mentoring}{%
		\Mentees=Mentees,
		\Project=Project,
		\Presented=Presented,
		\AcademicYear=AcademicYear%
	}{%
		\item{\Mentees
			\begin{itemize}[
			topsep=0pt,
			partopsep=0pt,
			parsep=0pt,
			itemsep=0pt
			]
				\item{\textit{\Project}}
				\item{\Presented}
			\end{itemize}
		}%
		%
	}%
	\end{itemize}
}%

% ------------------------------------------------------------------------------------------------
% PROFESSIONAL SERVICE
% ------------------------------------------------------------------------------------------------
\section*{Professional Service}

\DTLforeach*{service}{%
	\Role=Role,
	\Organization=Organization,
	\URL=URL,
	\Location=Location,
	\StartDate=StartDate,
	\EndDate=EndDate%
}{%
	\begin{minipage}{\textwidth}
		\textbf{\Role} \hfill \DTLifnullorempty{\StartDate}{\EndDate}{\StartDate\ -- \EndDate}\par
		\DTLifnullorempty{\URL}{\textit{\Organization}}{\textit{\Colorhref{\URL}{\Organization}}}, \textit{\Location}
		\DTLiflastrow{}{\vspace{1ex}}
	\end{minipage}
	%
}%

% ------------------------------------------------------------------------------------------------
% PROFESSIONAL AFFILIATIONS
% ------------------------------------------------------------------------------------------------
\section*{Professional Affiliations}

\DTLforeach*{affiliations}{%
	\Title=Title,
	\Organization=Organization,
	\StartDate=StartDate,
	\EndDate=EndDate%
}{%
	\begin{minipage}{\textwidth}
		\textbf{\Title} \hfill \DTLifnullorempty{\StartDate}{\EndDate}{\StartDate\ -- \EndDate}\par
		\textit{\Organization}
		\DTLiflastrow{}{\vspace{1ex}}
	\end{minipage}
	%
}%

% ------------------------------------------------------------------------------------------------
% SKILLS
% ------------------------------------------------------------------------------------------------
\section*{Skills}

\foreach \x in \SkillTypes{%
	\subsection*{\x}
	%
	\begin{description}
	%
	\DTLforeach*[\DTLiseq{\Type}{\x}]{skills}{%
		\Type=Type,
		\SkillLevel=SkillLevel,
		\Skill=Skill%
	}{%
		\item[\SkillLevel]{\Skill}
		%
	}%
	\end{description}
}%

\end{document}